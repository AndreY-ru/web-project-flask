{% extends 'base.html' %}

{% block title %}–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ{% endblock %}

{% block body %}

<main class="container">

  <nav class="tabs">
    <button class="tab" onclick="showTab('general', this)">üìã –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</button>
    <button class="tab" onclick="showTab('courseworks', this)">üñäÔ∏è –ö—É—Ä—Å–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã</button>
    <button class="tab" onclick="showTab('practical', this)">üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã</button>
    <button class="tab" onclick="showTab('achievements', this)">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
    <button class="tab" onclick="showTab('mobility', this)">üìå –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å</button>
  </nav>

  {% for cat, items in portfolio.items() %}
  <section id="{{ cat }}" class="card form-section tab-content">

    <h3>
      {% if cat == 'general' %}üìã –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è{% endif %}
      {% if cat == 'courseworks' %}üñäÔ∏è –ö—É—Ä—Å–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã{% endif %}
      {% if cat == 'practical' %}üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã{% endif %}
      {% if cat == 'achievements' %}üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è{% endif %}
      {% if cat == 'mobility' %}üìå –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å{% endif %}
    </h3>

    <!-- –°–ø–∏—Å–æ–∫ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ -->
    {% if items %}
      <ul>
        {% for item in items %}
          <li>
            {% if item.title %}<strong>{{ item.title }}</strong><br>{% endif %}
            {{ item.description }}<br>
            {% if item.file_path %}
              <a href="{{ url_for('static', filename=item.file_path) }}" target="_blank">üìé –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</a>
            {% endif %}
            <p>
            <form action="{{ url_for('delete_portfolio_item', item_id=item.id) }}" method="post" style="display:inline;">
              <button type="submit" class="btn-delete">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            </form></p>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö.</p>
    {% endif %}

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ -->
    <form method="post" enctype="multipart/form-data" style="margin-top: 20px;">
      <input type="hidden" name="category" value="{{ cat }}">
      {% if cat in ['courseworks', 'practical'] %}
        <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã" style="width: 100%; margin-bottom: 10px;">
      {% endif %}
      <textarea name="description" rows="4" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ..." style="width: 100%; margin-bottom: 10px;"></textarea>
      <label>üìé –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª (DOC, DOCX, PDF, JPG, PNG, –¥–æ 10–ú–ë):</label><br>
      <input type="file" name="file"><br><br>
      <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>

  </section>
  {% endfor %}
</main>

<script>
  function showTab(tabId, button) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.remove('active');
    });

    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.tab').forEach(tab => {
      tab.classList.remove('active');
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
    document.getElementById(tabId).classList.add('active');

    // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π
    button.classList.add('active');

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –≤ localStorage
    localStorage.setItem('activeTab', tabId);
  }


  // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
  window.addEventListener('DOMContentLoaded', () => {
  const savedTab = localStorage.getItem('activeTab');
  if (savedTab) {
    const button = [...document.querySelectorAll('.tab')].find(btn =>
      btn.getAttribute('onclick')?.includes(savedTab)
    );
    if (button) {
      button.click();
    } else {
      document.querySelector('.tab').click();
    }
  } else {
    document.querySelector('.tab').click(); // –ø–µ—Ä–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  }
});

</script>


{% endblock %}
